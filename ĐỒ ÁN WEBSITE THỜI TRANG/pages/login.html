<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Đăng nhập | FashionShop</title>

  <!-- dùng style chung -->
    <link rel="stylesheet" href="../css/site.css">
  <!-- tuỳ chọn: thêm chút style cho form -->
  <style>
    .auth-wrap{max-width: 480px; margin: 48px auto; background:#fff; border:1px solid var(--border,#eee); border-radius:16px; padding:24px; box-shadow:0 10px 32px rgba(0,0,0,.05);}
    .auth-title{font-size:24px; font-weight:800; margin:0 0 8px;}
    .auth-sub{color:#6b7280; margin:0 0 20px;}
    .form-row{display:flex; flex-direction:column; gap:6px; margin-bottom:14px;}
    .form-row input{height:42px; border:1px solid #e5e7eb; border-radius:10px; padding:0 12px;}
    .form-actions{display:flex; gap:10px; align-items:center; justify-content:space-between; margin-top:6px;}
    .muted{color:#6b7280;}
    .err{color:#c62828; font-size:14px; margin:6px 0 0; min-height:18px;}
  </style>
</head>
<body class="page-auth">

<header class="site-header">
  <div class="container header-inner">
    <a class="brand" href="./index.html">Fashion<span>Shop</span></a>

    <nav class="main-nav" aria-label="Chính">
      <a href="./index.html">Trang chủ</a>

      <!-- Danh mục: dropdown -->
      <div class="nav-dd">
        <button class="dd-trigger" type="button" aria-haspopup="true" aria-expanded="false">
          Danh mục ▾
        </button>
        <ul class="dd-menu" role="menu" aria-label="Danh mục">
          <li><a role="menuitem" href="./user-category.html?category=Trang%20phục%20Xuân%20Hè">Trang phục Xuân Hè</a></li>
          <li><a role="menuitem" href="./user-category.html?category=Trang%20phục%20Thu%20Đông">Trang phục Thu Đông</a></li>
          <li><a role="menuitem" href="./user-category.html?category=Giày%20dép">Giày dép</a></li>
          <li><a role="menuitem" href="./user-category.html?category=Phụ%20kiện">Phụ kiện</a></li>
        </ul>
      </div>

      <a href="./user-category.html" class="all-products-link">Tất cả sản phẩm</a>
      <a href="./user-orders.html" class="orders-link">Đơn hàng</a>
      <button type="button" class="icon-btn" id="openSearch">Tìm kiếm</button>
      <a href="./cart.html">Giỏ hàng</a>
    </nav>

    <a href="./login.html" class="actions account-login">
      <span class="avatar anon" aria-hidden="true"></span>
      <span class="account-text">Đăng nhập</span>
    </a>
  </div>
</header>

<!-- Search Overlay & Modal -->
<div id="searchOverlay" class="search-overlay" hidden></div>
<div id="searchModal" class="search-modal" hidden role="dialog" aria-labelledby="searchTitle">
  <form id="searchForm" class="search-form" autocomplete="off">
    <h3 id="searchTitle" class="search-title">Bạn cần gì?</h3>

    <label class="sr-only" for="sName">Tên sản phẩm</label>
    <input id="sName" type="text" placeholder="Nhập tên sản phẩm..." aria-label="Tìm theo tên sản phẩm" />

    <div class="row cat-row">
      <span class="blocklabel">Loại sản phẩm</span>
      <div class="cat-radios" role="radiogroup" aria-label="Loại sản phẩm">
        <label class="radio"><input type="radio" name="cat" value="" checked><span class="dot"></span><span class="text">Tất cả</span></label>
        <label class="radio"><input type="radio" name="cat" value="Trang phục Xuân Hè"><span class="dot"></span><span class="text">Trang phục Xuân Hè</span></label>
        <label class="radio"><input type="radio" name="cat" value="Trang phục Thu Đông"><span class="dot"></span><span class="text">Trang phục Thu Đông</span></label>
        <label class="radio"><input type="radio" name="cat" value="Giày dép"><span class="dot"></span><span class="text">Giày dép</span></label>
        <label class="radio"><input type="radio" name="cat" value="Phụ kiện"><span class="dot"></span><span class="text">Phụ kiện</span></label>
      </div>
      <input type="hidden" id="sCategory" value="">
    </div>

    <div class="row price-row">
      <span class="blocklabel">Khoảng giá (VNĐ)</span>
      <div class="range">
        <input id="sMin" type="number" min="0" step="50000" placeholder="Tối thiểu" aria-label="Giá tối thiểu" />
        <span>—</span>
        <input id="sMax" type="number" min="0" step="50000" placeholder="Tối đa" aria-label="Giá tối đa" />
      </div>
    </div>

    <div class="search-actions">
      <button type="button" class="btn-ghost" id="closeSearch">Đóng</button>
      <button type="submit" class="btn btn-primary">Tìm kiếm</button>
    </div>
  </form>
</div>


  <main class="container">
    <div class="auth-wrap">
      <h1 class="auth-title">Đăng nhập</h1>
      <p class="auth-sub">Đăng nhập để sử dụng giỏ hàng và theo dõi đơn.</p>

      <form id="loginForm" autocomplete="on" novalidate>
        <div class="form-row">
          <label for="email">Email</label>
          <input id="email" name="email" type="email" required placeholder="you@example.com" />
        </div>
        <div class="form-row">
          <label for="password">Mật khẩu</label>
          <input id="password" name="password" type="password" required placeholder="••••••••" />
        </div>
        <div class="form-actions">
          <button type="submit" class="btn btn-primary" id="btnLogin">Đăng nhập</button>
          <a class="btn-ghost" href="./register.html">Đăng ký</a>
        </div>
        <div id="err" class="err"></div>
      </form>

      <p class="muted" style="margin-top:10px;">Tip demo: bạn có thể dùng bất kỳ email/mật khẩu nào.</p>
    </div>
  </main>

  <footer class="site-footer"><div class="container">© 2025 FashionShop</div></footer>

  <!-- JS -->
  <script src="../js/login.js"></script>

  <script>
(function(){
  var u = null;
  try { u = JSON.parse(localStorage.getItem('currentUser') || 'null'); } catch(e){}

  // Đơn hàng (user)
  var linkOrders = document.querySelector('a.orders-link');
  if (linkOrders && !u) linkOrders.href = './login.html?next=user-orders.html';

  // Giỏ hàng
  var linkCart = document.querySelector('a[href$="cart.html"]');
  if (linkCart && !u) linkCart.href = './login.html?next=cart.html';
})();
</script>

<script>
(function(){
  const openBtn = document.getElementById('openSearch');
  const modal = document.getElementById('searchModal');
  const overlay = document.getElementById('searchOverlay');
  const closeBtn = document.getElementById('closeSearch');
  const form = document.getElementById('searchForm');

  function openModal(){ modal.hidden = false; overlay.hidden = false; document.getElementById('sName').focus(); }
  function closeModal(){ modal.hidden = true; overlay.hidden = true; }

  openBtn?.addEventListener('click', openModal);
  closeBtn?.addEventListener('click', closeModal);
  overlay?.addEventListener('click', closeModal);
  document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeModal(); });

  const hiddenCat = document.getElementById('sCategory');
  document.querySelectorAll('.cat-radios input[name="cat"]').forEach(r=>{
    r.addEventListener('change', ()=> hiddenCat.value = r.value);
  });

  form?.addEventListener('submit', (e)=>{
    e.preventDefault();
    const q = document.getElementById('sName').value.trim();
    const category = document.getElementById('sCategory').value.trim();
    const min = document.getElementById('sMin')?.value.trim();
    const max = document.getElementById('sMax')?.value.trim();

    const params = new URLSearchParams();
    if(q) params.append('q', q);
    if(category) params.append('category', category);
    if(min) params.append('min', min);
    if(max) params.append('max', max);

    window.location.href = './search.html?' + params.toString();
  });

  const dd = document.querySelector('.nav-dd');
  const ddBtn = dd?.querySelector('.dd-trigger');
  const ddMenu = dd?.querySelector('.dd-menu');
  let closeTimeout;

  dd?.addEventListener('mouseenter', () => { clearTimeout(closeTimeout); ddMenu.style.display = 'block'; ddBtn.setAttribute('aria-expanded', 'true'); });
  dd?.addEventListener('mouseleave', () => { closeTimeout = setTimeout(() => { ddMenu.style.display = 'none'; ddBtn.setAttribute('aria-expanded', 'false'); }, 200); });
  ddBtn?.addEventListener('click', (e) => {
    const isOpen = ddMenu.style.display === 'block';
    ddMenu.style.display = isOpen ? 'none' : 'block';
    ddBtn.setAttribute('aria-expanded', String(!isOpen));
    e.stopPropagation();
  });
  document.addEventListener('click', (e) => {
    if (!dd?.contains(e.target)) { ddMenu.style.display = 'none'; ddBtn?.setAttribute('aria-expanded', 'false'); }
  });
})();
</script>

<script>
(function(){
  const user = JSON.parse(localStorage.getItem('currentUser') || 'null');
  const topAccount = document.querySelector('.account-login');
  if (user && topAccount) {
    const displayName = (user.name || 'Hồ sơ').trim().split(/\s+/).pop();
    topAccount.href = './profile.html';
    topAccount.innerHTML = `
      <span class="avatar" aria-hidden="true"></span>
      <span class="account-text">${displayName}</span>
    `;
  }
})();
</script>

</body>
</html>
