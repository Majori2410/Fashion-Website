<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Giỏ hàng | FashionShop</title>

  <link rel="stylesheet" href="../css/site.css">
  <link rel="stylesheet" href="../css/cart.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap&subset=vietnamese" rel="stylesheet">
</head>

<body class="page-cart">
  <header class="site-header">
    <div class="container header-inner">
        <a class="brand" href="./index.html">Fashion<span>Shop</span></a>
        <nav class="main-nav" aria-label="Chính">
        <a href="./index.html">Trang chủ</a>

        <!-- Dropdown Danh mục (giống user-category.html) -->
        <div class="nav-dd">
            <button class="dd-trigger" type="button" aria-haspopup="true" aria-expanded="false">Danh mục ▾</button>
            <ul class="dd-menu" role="menu" aria-label="Danh mục">
            <li><a role="menuitem" href="./user-category.html?category=Trang%20phục%20Xuân%20Hè">Trang phục Xuân Hè</a></li>
            <li><a role="menuitem" href="./user-category.html?category=Trang%20phục%20Thu%20Đông">Trang phục Thu Đông</a></li>
            <li><a role="menuitem" href="./user-category.html?category=Giày%20dép">Giày dép</a></li>
            <li><a role="menuitem" href="./user-category.html?category=Phụ%20kiện">Phụ kiện</a></li>
            </ul>
        </div>

        <a href="./user-category.html" class="all-products-link">Tất cả sản phẩm</a>

        <!-- NEW: Đơn hàng -->
        <a href="./user-orders.html" class="orders-link">Đơn hàng</a>

        <button type="button" class="icon-btn" id="openSearch">Tìm kiếm</button>
        <a href="./cart.html" class="active">Giỏ hàng</a>
        </nav>

        <a href="./login.html" class="actions account-login">
        <span class="avatar anon" aria-hidden="true"></span>
        <span class="account-text">Đăng nhập</span>
        </a>
    </div>
  </header>

  <section class="hero">
    <div class="container">
      <nav class="breadcrumbs" aria-label="breadcrumb">
        <a href="./index.html">Trang chủ</a><span></span>
        <span>Giỏ hàng</span>
      </nav>
      <h1>Giỏ hàng của bạn</h1>
    </div>
  </section>


  <main class="container cart-page cart-wrap">

    <!-- Cart tools: chọn tất cả -->
  <div class="cart-tools">
  <label class="chk-all">
    <input type="checkbox" id="chkAll" />
    <span id="chkAllText">Chọn tất cả</span>
  </label>

  <span class="sep-dot" aria-hidden="true"></span>

  <span class="selcount muted">Đã chọn <b id="selCount">0</b></span>
</div>

    <section id="cartItems" class="cart-items"></section>

    <div class="cart-summary">
      <div class="sum-line">
        <span>Tạm tính:</span>
        <strong id="subtotal">0₫</strong>
      </div>
      <div class="sum-line total">
        <span>Tổng cộng:</span>
        <strong id="total">0₫</strong>
      </div>
      <button id="checkoutBtn" class="btn btn-primary">Thanh toán</button>
    </div>
  </main>

  <!-- Sticky total bar (desktop) -->
  <div class="cart-sticky-total" id="cartStickyTotal" hidden>
    <div class="inner">
      <span class="label">Tổng:</span>
      <strong class="value" id="totalBottom">0₫</strong>
      <button class="btn btn-primary" id="checkoutBtnBottom">Thanh toán</button>
    </div>
  </div>

  <footer class="site-footer">
    <div class="container">
      © 2025 FashionShop
    </div>
  </footer>

  <!-- Guard: yêu cầu đăng nhập mới vào cart -->
  <script>
  (function () {
    try {
      var user = JSON.parse(localStorage.getItem('currentUser') || 'null');
      if (!user) {
        // quay về login, rồi trở lại cart sau khi đăng nhập
        location.href = './login.html?next=cart.html';
      }
    } catch (e) {
      location.href = './login.html?next=cart.html';
    }
  })();
  </script>

  <!-- Guard: yêu cầu đăng nhập mới vào cart -->
  <script>
  (function () {
    try {
      var user = JSON.parse(localStorage.getItem('currentUser') || 'null');
      if (!user) {
        // quay về login, rồi trở lại cart sau khi đăng nhập
        location.href = './login.html?next=cart.html';
      }
    } catch (e) {
      location.href = './login.html?next=cart.html';
    }
  })();
  </script>

  <!-- DỮ LIỆU SẢN PHẨM NHÚNG TRỰC TIẾP (thay cho fetch products.json) -->
  <script id="products-data" type="application/json">
  [
    { 
      "id": 1, 
      "name": "Đầm Nữ Sơ Mi Cotton Tay Ngắn Rút Dây Regular", 
      "category": "Trang phục Xuân Hè", 
      "price": 590000, 
      "img": "../assets/products/1.webp",
      "sizes": ["S","M","L","XL"], 
      "description": [
        "Chất liệu cotton thoáng mát, phom A-line tôn dáng. Phù hợp đi làm, dạo phố.",
        "Chất liệu: Cotton 100%",
        "Xuất xứ: Việt Nam",
        "Giặt máy chế độ nhẹ, không tẩy."
      ],
      "images": [
        "../assets/products/1.webp",
        "../assets/products/1.1.webp",
        "../assets/products/1.2.webp",
        "../assets/products/1.3.webp"
      ]
    },
    { 
      "id": 2, 
      "name": "Áo tanktop Slimme.Fitted", 
      "category": "Trang phục Xuân Hè", 
      "price": 160200, 
      "img": "../assets/products/2.webp" 
    },
    { 
      "id": 4, 
      "name": "Quần Denim Nữ Xanh Navy Rã Phối Form Balloon", 
      "category": "Trang phục Xuân Hè", 
      "price": 633000, 
      "img": "../assets/products/3.webp" 
    },
    { 
      "id": 3, 
      "name": "Áo Thun Tanktop Nam Sát Nách Cotton Form Loose", 
      "category": "Trang phục Xuân Hè", 
      "price": 373000, 
      "img": "../assets/products/4.webp" 
    },
    { 
      "id": 5, 
      "name": "Áo Thun Nam Tay Ngắn Thêu Chữ Trước Ngực Fitted", 
      "category": "Trang phục Xuân Hè", 
      "price": 343000, 
      "img": "../assets/products/5.webp" 
    },
    { 
      "id": 6, 
      "name": "Quần Short Nam Cotton Lưng Thun In Chữ Form Relax", 
      "category": "Trang phục Xuân Hè", 
      "price": 392000, 
      "img": "../assets/products/6.webp" 
    },
    { 
      "id": 7, 
      "name": "BE BOLD DERBY", 
      "category": "Giày dép", 
      "price": 2350000, 
      "img": "../assets/products/7.webp",
      "sizes": ["38","39","40","41","42","43","44","45"], 
      "description": [
        "Đại diện cho sự thoải mái và phóng khoáng, Be Bold Derby là ứng cử viên sáng giá cho các quý ông đang tìm kiếm một đôi giày có thể dễ dàng kết hợp với nhiều loại trang phục. Với sự kỳ công và tỉ mỉ trong thiết kế lẫn chất liệu, Fashion shop tin chắc rằng đôi giày Derby này sẽ giúp các quý ông nâng tầm phong cách cá nhân, đồng thời thể hiện cái tôi của bản thân."
      ],
      "images": [
        "../assets/products/7.webp",
        "../assets/products/7.1.webp",
        "../assets/products/7.2.webp",
        "../assets/products/7.3.webp"
      ]
    }, 
    { 
      "id": 8, 
      "name": "Giày Sandal Nữ MWC E196", 
      "category": "Giày dép", 
      "price": 195000, 
      "img": "../assets/products/8.jpg" 
    },
    { 
      "id": 9, 
      "name": "Giày Cao Gót MWC G266", 
      "category": "Giày dép", 
      "price": 235000, 
      "img": "../assets/products/9.jpg" 
    },
    { 
      "id": 10, 
      "name": "Giày Cao Gót Kiểu Dáng Basic Bít Mũi Bít Gót", 
      "category": "Giày dép", 
      "price": 237500, 
      "img": "../assets/products/10.jpg" 
    },
    { 
      "id": 11, 
      "name": "Giày Sneaker Nam Form Giày Cá Tính, Phối Màu Hiện Đại, Streetwear Chuẩn Chất", 
      "category": "Giày dép", 
      "price": 39500, 
      "img": "../assets/products/11.jpg" 
    },
    { 
      "id": 12, 
      "name": "Dép Sục Nam Quai Liền Khối Bản Rộng Phối Khoá Kim Loại", 
      "category": "Giày dép", 
      "price": 34500, 
      "img": "../assets/products/12.jpg" 
    },
    { 
      "id": 13, 
      "name": "Áo dệt kim tay dài nam. Loose", 
      "category": "Trang phục Thu Đông", 
      "price": 687000, 
      "img": "../assets/products/13.webp",
      "sizes": ["S","M","L","XL"], 
      "description": [
        "Áo len cổ tròn đỏ - lựa chọn lý tưởng cho nam giới yêu thích phong cách tối giản nhưng nổi bật. Màu đỏ rực rỡ kết hợp cùng phụ kiện tối màu giúp tôn lên sự tự tin và cá tính.",
        "Chất liệu: Len cao cấp, mềm mịn, giữ ấm tốt",
        "Màu sắc: Đỏ đô",
        "Kiểu dáng: Cổ tròn, tay dài, form regular"
      ],
      "images": [
        "../assets/products/13.webp",
        "../assets/products/13.1.webp",
        "../assets/products/13.2.webp",
        "../assets/products/13.3.webp"
      ]
    },
    { 
      "id": 14, 
      "name": "Áo gile phao nam đen", 
      "category": "Trang phục Thu Đông", 
      "price": 999000, 
      "img": "../assets/products/14.webp" 
    },
    { 
      "id": 15, 
      "name": "Bộ nỉ basic unisex", 
      "category": "Trang phục Thu Đông", 
      "price": 765000, 
      "img": "../assets/products/15.webp" 
    },
    { 
      "id": 16, 
      "name": "Áo len dệt kim nữ trắng viền đen", 
      "category": "Trang phục Thu Đông", 
      "price": 455000, 
      "img": "../assets/products/16.webp" 
    },
    { 
      "id": 17, 
      "name": "Áo ôm cổ cao nữ màu xám nhạt", 
      "category": "Trang phục Thu Đông", 
      "price": 473000, 
      "img": "../assets/products/17.webp" 
    },
    { 
      "id": 18, 
      "name": "Áo len nữ đen viền trắng basic", 
      "category": "Trang phục Thu Đông", 
      "price": 788000, 
      "img": "../assets/products/18.webp" 
    },
    { 
      "id": 19, 
      "name": "Mặt dây chuyền Bán Nguyệt Ánh Lam", 
      "category": "Phụ kiện", 
      "price": 3910000, 
      "img": "../assets/products/19.png",
      "sizes": ["30","31","32","33"], 
      "description": [
        "Lấy cảm hứng từ ánh trăng dịu dàng, Mặt dây chuyền Bán Nguyệt Ánh Lam được chế tác từ bạc cao cấp với phần mặt trăng ánh lam óng ánh. Thiết kế đơn giản mà tinh tế, tượng trưng cho sự nữ tính và bí ẩn.",
        "Chất liệu: Bạc 925 phủ bóng.",
        "Màu sắc: Ánh bạc kết hợp lam nhẹ.",
        "Kiểu dáng: Hình bán nguyệt.",
        "Phù hợp với: Vòng tay, dây chuyền hoặc charm mix nhiều kiểu."
      ],
      "images": [
        "../assets/products/19.png",
        "../assets/products/19.1.png",
        "../assets/products/19.2.png",
        "../assets/products/19.3.png"
      ]
    },
    { 
      "id": 20, 
      "name": "Ba lô thời trang unisex MWC hai tông xám", 
      "category": "Phụ kiện", 
      "price": 622000, 
      "img": "../assets/products/20.jpg" 
    },
    { 
      "id": 21, 
      "name": "Scrunchie ren hoa vintage nơ đỏ", 
      "category": "Phụ kiện", 
      "price": 177000, 
      "img": "../assets/products/21.jpeg" 
    },
    { 
      "id": 22, 
      "name": "Bịt tai lông siêu mềm Moji trắng sữa", 
      "category": "Phụ kiện", 
      "price": 245000, 
      "img": "../assets/products/22.jpeg" 
    },
    { 
      "id": 23, 
      "name": "Găng tay len hồng nơ xanh dễ thương", 
      "category": "Phụ kiện", 
      "price": 215000, 
      "img": "../assets/products/23.jpeg" 
    },
    { 
      "id": 24, 
      "name": "Mũ tai thỏ lông mềm nơ trắng", 
      "category": "Phụ kiện", 
      "price": 399000, 
      "img": "../assets/products/24.jpeg" 
    }
  ]
  </script>

  <!-- DỮ LIỆU GIỎ HÀNG NHÚNG TRỰC TIẾP (thay cho fetch cart.json) -->
  <script id="cart-data" type="application/json">
  [
    {
      "id": "1",
      "size": "M",
      "qty": 2
    },
    {
      "id": "7",
      "size": "41",
      "qty": 1
    }
  ]
  </script>

  <script src="../js/cart.js"></script>

  <script src="../js/search-modal.js" defer></script>

<!-- Search Popover -->
<div id="searchOverlay" class="search-overlay" hidden></div>
<div id="searchModal" class="search-modal" hidden role="dialog" aria-labelledby="searchTitle">
  <form id="searchForm" class="search-form" autocomplete="off">
    <h3 id="searchTitle" class="search-title">Bạn cần gì?</h3>

    <label class="sr-only" for="sName">Tên sản phẩm</label>
    <input id="sName" type="text" placeholder="Nhập tên sản phẩm..." aria-label="Tìm theo tên sản phẩm" />

    <div class="row cat-row">
      <span class="blocklabel">Loại sản phẩm</span>
      <div class="cat-radios" role="radiogroup" aria-label="Loại sản phẩm">
        <label class="radio"><input type="radio" name="cat" value="" checked><span class="dot"></span><span class="text">Tất cả</span></label>
        <label class="radio"><input type="radio" name="cat" value="Trang phục Xuân Hè"><span class="dot"></span><span class="text">Trang phục Xuân Hè</span></label>
        <label class="radio"><input type="radio" name="cat" value="Trang phục Thu Đông"><span class="dot"></span><span class="text">Trang phục Thu Đông</span></label>
        <label class="radio"><input type="radio" name="cat" value="Giày dép"><span class="dot"></span><span class="text">Giày dép</span></label>
        <label class="radio"><input type="radio" name="cat" value="Phụ kiện"><span class="dot"></span><span class="text">Phụ kiện</span></label>
      </div>
      <input type="hidden" id="sCategory" value="">
    </div>

    <div class="row price-row">
      <span class="blocklabel">Khoảng giá (VNĐ)</span>
      <div class="range">
        <input id="sMin" type="number" min="0" step="50000" placeholder="Tối thiểu" aria-label="Giá tối thiểu" />
        <span>—</span>
        <input id="sMax" type="number" min="0" step="50000" placeholder="Tối đa" aria-label="Giá tối đa" />
      </div>
    </div>

    <div class="search-actions">
      <button type="button" class="btn-ghost" id="closeSearch">Đóng</button>
      <button type="submit" class="btn btn-primary">Tìm kiếm</button>
    </div>
  </form>
</div>

<script>
  //nếu bấm vào giỏ hàng ở top bar hoặc nút thêm vào giỏ mà chưa đăng nhập thì tự động điều hướng sang login
  (function(){
    var u = null;
    try { u = JSON.parse(localStorage.getItem('currentUser') || 'null'); } catch(e){}
    var link = document.querySelector('a[href$="cart.html"]');
    if (link && !u) link.href = './login.html?next=cart.html';
  })();
</script>

<script src="../js/auth-ui.js"></script>

</body>
</html>
