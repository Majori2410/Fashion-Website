<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Hồ sơ cá nhân</title>
  <link rel="stylesheet" href="../css/site.css"><!-- nếu có -->
  <link rel="stylesheet" href="../css/profile.css">
</head>
<body>
  <!-- Header giống các trang user: nhớ có .account-login để auth-ui.js gắn dropdown -->
  <header class="site-header">
    <div class="container header-inner">
      <a class="brand" href="./index.html">Fashion<span>Shop</span></a>
      <nav class="main-nav" aria-label="Chính">
        <a href="./index.html">Trang chủ</a>

        <!-- Danh mục: dropdown -->
        <div class="nav-dd">
          <button class="dd-trigger" type="button" aria-haspopup="true" aria-expanded="false">
            Danh mục ▾
          </button>
          <ul class="dd-menu" role="menu" aria-label="Danh mục">
            <li><a role="menuitem" href="./search.html?category=Trang%20phục%20Xuân%20Hè">Trang phục Xuân Hè</a></li>
            <li><a role="menuitem" href="./search.html?category=Trang%20phục%20Thu%20Đông">Trang phục Thu Đông</a></li>
            <li><a role="menuitem" href="./search.html?category=Giày%20dép">Giày dép</a></li>
            <li><a role="menuitem" href="./search.html?category=Phụ%20kiện">Phụ kiện</a></li>
          </ul>
        </div>

        <a href="./user-category.html" class="all-products-link">Tất cả sản phẩm</a>
        <a href="./user-orders.html" class="orders-link">Đơn hàng</a>
        <button type="button" class="icon-btn" id="openSearch">Tìm kiếm</button>
        <a href="./cart.html">Giỏ hàng</a>
      </nav>

      <a class="actions account-login" href="./login.html">
        <span class="avatar anon" aria-hidden="true"></span>
        <span class="account-text">Đăng nhập</span>
      </a>
    </div>
  </header>

  <!-- Search Overlay & Modal (đồng bộ như index) -->
  <div id="searchOverlay" class="search-overlay" hidden></div>

  <div id="searchModal" class="search-modal" hidden role="dialog" aria-labelledby="searchTitle">
    <form id="searchForm" class="search-form" autocomplete="off">
      <h3 id="searchTitle" class="search-title">Bạn cần gì?</h3>

      <!-- Tên sản phẩm -->
      <label class="sr-only" for="sName">Tên sản phẩm</label>
      <input id="sName" type="text" placeholder="Nhập tên sản phẩm..." aria-label="Tìm theo tên sản phẩm" />

      <!-- Loại sản phẩm -->
      <div class="row cat-row">
        <span class="blocklabel">Loại sản phẩm</span>
        <div class="cat-radios" role="radiogroup" aria-label="Loại sản phẩm">
          <label class="radio">
            <input type="radio" name="cat" value="" checked>
            <span class="dot"></span><span class="text">Tất cả</span>
          </label>
          <label class="radio">
            <input type="radio" name="cat" value="Trang phục Xuân Hè">
            <span class="dot"></span><span class="text">Trang phục Xuân Hè</span>
          </label>
          <label class="radio">
            <input type="radio" name="cat" value="Trang phục Thu Đông">
            <span class="dot"></span><span class="text">Trang phục Thu Đông</span>
          </label>
          <label class="radio">
            <input type="radio" name="cat" value="Giày dép">
            <span class="dot"></span><span class="text">Giày dép</span>
          </label>
          <label class="radio">
            <input type="radio" name="cat" value="Phụ kiện">
            <span class="dot"></span><span class="text">Phụ kiện</span>
          </label>
        </div>
        <input type="hidden" id="sCategory" value="">
      </div>

      <!-- Khoảng giá -->
      <div class="row price-row">
        <span class="blocklabel">Khoảng giá (VNĐ)</span>
        <div class="range">
          <input id="sMin" type="number" min="0" step="50000" placeholder="Tối thiểu" aria-label="Giá tối thiểu" />
          <span>—</span>
          <input id="sMax" type="number" min="0" step="50000" placeholder="Tối đa" aria-label="Giá tối đa" />
        </div>
      </div>

      <div class="search-actions">
        <button type="button" class="btn-ghost" id="closeSearch">Đóng</button>
        <button type="submit" class="btn btn-primary">Tìm kiếm</button>
      </div>
    </form>
  </div>

  <main class="container profile-wrap">
    <h1>Hồ sơ cá nhân</h1>

    <form id="profileForm" class="card" autocomplete="off">
      <div class="profile-head">
        <div class="avatar-big" id="avatarView" title="Ảnh/Chữ cái">
          <!-- auth-ui.js đang dùng chữ cái đầu, nên ở đây hiển thị ảnh (nếu có URL) hoặc chữ cái -->
          <img id="avatarImg" alt="" hidden>
          <span id="avatarInitial">U</span>
        </div>
        <div class="hint">Bạn có thể thay đổi tên, điện thoại, địa chỉ… Email dùng đăng nhập nên giữ nguyên.</div>
      </div>

      <div class="grid">
        <label class="field">
          <span>Họ và tên</span>
          <input id="fName" type="text" placeholder="Nguyễn Văn A" required>
        </label>

        <label class="field">
          <span>Email (đăng nhập)</span>
          <input id="fEmail" type="email" placeholder="email@domain.com" disabled>
        </label>

        <label class="field">
          <span>Số điện thoại</span>
          <input id="fPhone" type="tel" placeholder="09xx xxx xxx">
        </label>

        <label class="field">
          <span>Ngày sinh</span>
          <input id="fDob" type="date">
        </label>

        <label class="field full">
          <span>Địa chỉ</span>
          <input id="fAddress" type="text" placeholder="Số nhà, đường, phường/xã, quận/huyện, tỉnh/thành">
        </label>

        <label class="field full">
          <span>Ảnh đại diện (URL, tùy chọn)</span>
          <input id="fAvatar" type="url" placeholder="https://...">
          <small class="muted">Có thể để trống để dùng chữ cái đầu như ở menu.</small>
        </label>
      </div>

      <div class="actions">
        <button type="button" class="btn-ghost" id="btnCancel">Hủy</button>
        <button type="submit" class="btn-primary">Lưu thay đổi</button>
      </div>
    </form>
  </main>

  <footer class="site-footer">
    <div class="container">
      <div>© 2025 Fashion Shop</div>
    </div>
  </footer>

  <script src="../js/auth-ui.js"></script>
  <script src="../js/profile.js"></script>

  <script>
  (function(){
    const openBtn = document.getElementById('openSearch');
    const modal = document.getElementById('searchModal');
    const overlay = document.getElementById('searchOverlay');
    const closeBtn = document.getElementById('closeSearch');
    const form = document.getElementById('searchForm');

    function openModal(){
      modal.hidden = false; overlay.hidden = false;
      document.getElementById('sName').focus();
    }
    function closeModal(){
      modal.hidden = true; overlay.hidden = true;
    }

    openBtn?.addEventListener('click', openModal);
    closeBtn?.addEventListener('click', closeModal);
    overlay?.addEventListener('click', closeModal);
    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeModal(); });

    // Đồng bộ radio -> hidden
    const hiddenCat = document.getElementById('sCategory');
    document.querySelectorAll('.cat-radios input[name="cat"]').forEach(r=>{
      r.addEventListener('change', ()=>{
        hiddenCat.value = r.value;
      });
    });

    // Submit: build query và điều hướng sang search.html
    form?.addEventListener('submit', (e)=>{
      e.preventDefault();
      const q = document.getElementById('sName').value.trim();
      const category = document.getElementById('sCategory').value.trim();
      const min = document.getElementById('sMin').value.trim();
      const max = document.getElementById('sMax').value.trim();

      const params = new URLSearchParams();
      if(q) params.append('q', q);
      if(category) params.append('category', category);
      if(min) params.append('min', min);
      if(max) params.append('max', max);

      window.location.href = './search.html?' + params.toString();
    });

    // Dropdown "Danh mục"
    const dd = document.querySelector('.nav-dd');
    const ddBtn = dd?.querySelector('.dd-trigger');
    const ddMenu = dd?.querySelector('.dd-menu');
    let closeTimeout;

    dd?.addEventListener('mouseenter', () => {
      clearTimeout(closeTimeout);
      ddMenu.style.display = 'block';
      ddBtn.setAttribute('aria-expanded', 'true');
    });
    dd?.addEventListener('mouseleave', () => {
      closeTimeout = setTimeout(() => {
        ddMenu.style.display = 'none';
        ddBtn.setAttribute('aria-expanded', 'false');
      }, 200);
    });

    ddBtn?.addEventListener('click', (e) => {
      const isOpen = ddMenu.style.display === 'block';
      ddMenu.style.display = isOpen ? 'none' : 'block';
      ddBtn.setAttribute('aria-expanded', String(!isOpen));
      e.stopPropagation();
    });

    document.addEventListener('click', (e) => {
      if (dd && !dd.contains(e.target)) {
        ddMenu.style.display = 'none';
        ddBtn.setAttribute('aria-expanded', 'false');
      }
    });
  })();
  </script>

</body>
</html>
